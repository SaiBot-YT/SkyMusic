<html>
<style>
    body {
        padding: 1em;
        background-color: rgba(22, 22, 22, 0.95);
        color: #dad8b3;
        font-family: Arial;
    }

    .floatingMessage {
        position: fixed;
        width: 60%;
        left: calc(20% - 16px);
        height: 15vh;
        top: 50%;
        font-size: 25px;
        text-align: center;
        padding: 1em;
        font-family: Arial;
        font-weight: bold;
        color: #dad8b3;
        background-color: rgba(22, 22, 22, 0.95);
        display: none;
        z-index: 110;
        border: solid 2px #dad8b3;
        border-radius: 1em;
    }

    h1 {
        color: rgba(235, 0, 27, 0.8);
    }

    a {
        font-size: 1.5em;
        font-family: Arial;
    }
    @media only screen and (orientation:portrait) {
        li{
            margin-bottom: 10px;
        }
    }
    .skyButton {
        color: #dad8b3;
        font-size: 1.5em;
        background-color: rgba(22, 22, 22, 0.95);
        padding: 0.1em;
        cursor: pointer;
        margin: 0.5em;
        outline: none;
    }

    .skyButton2 {
        border: solid 2px #dad8b3;
        font-size: 1em;
        text-decoration: none;
        border-radius: 0.4em;
        box-sizing: border-box;
        background-color: rgba(22, 22, 22, 0.65);
        color: #dad8b3;
        font-weight: bold;
    }

    .select {
        border: solid 2px #dad8b3;
        font-size: 1em;
        text-decoration: none;
        border-radius: 0.3em;
        color: #dad8b3;
        background-color: rgba(22, 22, 22, 0.65);
        text-align-last: center;
        padding: 0 10px 0 10px;
        margin: 0 10px 0 10px;
        display: block;
        max-width: 50%;
    }

    .downloadSong {
        vertical-align: middle;
        width: 60px;
        height: 60px;
    }

    img {
        cursor: pointer;
    }
    skyButton {
        color: #dad8b3;
        border: solid #dad8b3 1.5px;
        background-color: rgba(22, 22, 22, 0.65);
        border-radius: 0.5em;
        font-size: 1em;
        padding: 0.4em;
        box-sizing: border-box;
        cursor: pointer;
        margin: 0.5em;
        outline: none;
    }
    c{

        color: #dad8b3;
    }

</style>

<head>
    <meta name="theme-color" content="#2196F3">
    <meta name="description" content="Song library for Sky Music!">
    <meta name="keywords" content="Sky,Music,piano,harp,xylophone,drum,guitar,horn,bell,record,share,midi">
    <meta name="author" content="thoseSkyModders">
    <meta name="mobile-web-app-capable" content="yes"> 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Sky Music Library">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="Sky.png">
    <meta property="og:image"
        content="https://repository-images.githubusercontent.com/261796811/08f6ec80-9ce7-11ea-8bf1-800c977cfaf1">
    <meta property="og:site_name" content="Sky Music Library">
    <meta property="og:title" content="Sky Music Library">
    <meta property="og:url" content="https://sky-music.herokuapp.com/">
    <meta property="og:description" content="Song library for Sky Music!">
    <link rel="icon" type="image/png" href="/favicon.png"/>
    <link rel="shortcut icon" href="/favicon.png?v=2" type="image/x-icon" />
    <title>Sky Music Library</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script data-cfasync='false' type='text/javascript' src='//p406170.clksite.com/adServe/banners?tid=406170_797105_0&type=footer&size=22'></script>
</head>

<body>
    <div id="floatingMessage" class="floatingMessage"> placeholder text </div>
    <div id="notes"></div>
    <a href="/" class=skyButton
        style="border:solid 2px #dad8b3; text-decoration: none; border-radius: 0.3em; padding: 0.2em; position: fixed; right:0">GO
        BACK</a>
        <br><br>
    <div style="font-size: 2em; font-family: Arial;">
        <div id="downloadPWA" style="display: inline-block; display: none;">
            <span>Download app</span>
            <img style="margin: 0.5em; vertical-align: middle" src="/download.png" width="75" height="75">
        </div>
        <div id="downloadAPK" style="display: inline-block;">
            <span>Download android app</span>
            <a href="/SkyMusic.apk"><img style="margin: 0.5em; vertical-align: middle" src="/download.png" width="75" height="75"></a>
        </div>
        <a href="https://discord.gg/NFFRTed" style="margin: 0.5em; vertical-align: middle"><img src="/discord.png"
                width="250" height="65"></a>
    </div>
    <div style="border-top: solid 2px #dad8b3; margin: 2em 0 2em 0; padding: 1em;">
        Press a song to hear it (Wait for it to load), to download it press the <img class="downloadSong">
        button.<br>
        Once you download a song, you will be able to listen to it in the "manage recordings"
    </div>
    <div style="display: flex; flex-direction: row; font-size: 1.5em; align-items: center;">
        Send us your song!
        <select id="selectedSong" class="select">
            <option selected disabled>Select song</option>
        </select>
        <button onclick="sendSong(this)" class="skyButton2">Send song</button>
    </div>
    <ul>
        <h1><c>▼</c> Song Pack</h1>

        <li><a>Song pack 1</a> <img class="downloadSong" onclick='downloadJSON("Song_pack_1")'><br></li>
        <li><a>Song pack 2</a> <img class="downloadSong" onclick='downloadJSON("Song_pack_2")'><br></li>
        <li><a>SCSM pack</a> <img class="downloadSong" onclick='downloadJSON("SCSM_pack")'><br></li>
    </ul>

    <ul class="listelement">
        <h1><c>▶</c> Easy</h1>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("You_are_my_Sunshine")'><skyButton onclick="playSong(this)">You are my Sunshine</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Ode_to_joy")'><skyButton onclick="playSong(this)">Ode to joy</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("The_lion_sleeps_tonight")'><skyButton onclick="playSong(this)">The lion sleeps tonight</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("undertale")'><skyButton onclick="playSong(this)">undertale</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Kum_Ba_Yah")'><skyButton onclick="playSong(this)">Kum Ba Yah</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Do-Re-Mi")'><skyButton onclick="playSong(this)">Do-Re-Mi</skyButton> <br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Binary_Sunset_Star_Wars")'><skyButton onclick="playSong(this)">Binary Sunset Star Wars</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("bad_romance_chorus")'><skyButton onclick="playSong(this)">bad romance chorus</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Tetris_Theme")'><skyButton onclick="playSong(this)">Tetris Theme</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Clementine")'><skyButton onclick="playSong(this)">Clementine</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Ive_Been_Working_on_the_Railroad")'><skyButton onclick="playSong(this)">Ive Been Working on the Railroad</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("la_Cucaracha")'><skyButton onclick="playSong(this)">la Cucaracha</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Lily_-_Alan_Walker")'><skyButton onclick="playSong(this)">Lily - Alan Walker</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Shatter_me")'><skyButton onclick="playSong(this)">Shatter me</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Ed_sheeran_perfect')"><skyButton onclick="playSong(this)">Ed sheeran perfect</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('lavender_Town')"><skyButton onclick="playSong(this)">lavender Town</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('San_Francisco')"><skyButton onclick="playSong(this)">San Francisco</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Scarborough_Fair')"><skyButton onclick="playSong(this)">Scarborough Fair</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Path_Of_The_Wind_-_My_Neighborhood_Is_Totoro_OST')"><skyButton onclick="playSong(this)">Path Of The Wind - My Neighborhood Is Totoro OST - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Firefall_SC')"><skyButton onclick="playSong(this)">Firefall SC</skyButton><br></li>    
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Hora_dels_Adeus')"><skyButton onclick="playSong(this)">Hora dels Adeus</skyButton><br></li>    
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Cant_help_falling_in_love')"><skyButton onclick="playSong(this)">Can't help falling in love</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Kygo_-_Firestone')"><skyButton onclick="playSong(this)">Kygo - Firestone</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Mitsuhas_Theme_YOUR_NAME')"><skyButton onclick="playSong(this)">Mitsuha's Theme (YOUR NAME)</skyButton><br></li>
    </ul> 
    <ul class="listelement">       
        <h1><c>▶</c> Medium</h1>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Davy_Joness_Theme")'><skyButton onclick="playSong(this)">Davy Joness Theme</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Hedwigs_Theme_Harry_Potter")'><skyButton onclick="playSong(this)">Hedwigs Theme Harry Potter</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Flohwalzer")'><skyButton onclick="playSong(this)">Flohwalzer</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Oh_Susanna")'><skyButton onclick="playSong(this)">Oh Susanna</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Take_Me_to_church")'><skyButton onclick="playSong(this)">Take Me to church</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Carrying_You_Laputa')"><skyButton onclick="playSong(this)">Carrying You Laputa</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Gravity_Falls_Theme')"><skyButton onclick="playSong(this)">Gravity Falls Theme</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('If_You_Are_Happy')"><skyButton onclick="playSong(this)">If You Are Happy</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Lord_Of_The_Rings_CM')"><skyButton onclick="playSong(this)">Lord Of The Rings CM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Ode_to_Joy_-_Hard')"><skyButton onclick="playSong(this)">Ode to Joy - Hard</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Owl_City_Fireflies')"><skyButton onclick="playSong(this)">Owl City Fireflies</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Route_01_Pokemon')"><skyButton onclick="playSong(this)">Route 01 Pokemon</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Skyrim_theme')"><skyButton onclick="playSong(this)">Skyrim theme</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Hallelujah')"><skyButton onclick="playSong(this)">Hallelujah</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Ashikata_and_San_-_Princess_Mononoke_OST')"><skyButton onclick="playSong(this)">Ashikata and San - Princess Mononoke OST - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('em_đã_bỏ_thuốc_chưa')"><skyButton onclick="playSong(this)">em đã bỏ thuốc chưa - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('I_Love_You_3000')"><skyButton onclick="playSong(this)">I Love You 3000 - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Merry_Go_Round_of_Life_-_Howl_Moving_Castle_OST')"><skyButton onclick="playSong(this)">Merry Go Round of Life - Howl's Moving Castle OST - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Mononoke_Hime_Medley')"><skyButton onclick="playSong(this)">Mononoke Hime Medley - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('One_Summer_Day_-_Spirited_Away_OST')"><skyButton onclick="playSong(this)">One Summer Day - Spirited Away OST - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Play_Date')"><skyButton onclick="playSong(this)">Play Date - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Ponyo_on_the_Cliff_By_the_Sea_-_Ponyo_OST')"><skyButton onclick="playSong(this)">Ponyo on the Cliff By the Sea - Ponyo OST - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('SUMMERTIME')"><skyButton onclick="playSong(this)">SUMMERTIME - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Summer_-_Joe_Hisaishi')"><skyButton onclick="playSong(this)">Summer - Joe Hisaishi - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Kataware_Doki')"><skyButton onclick="playSong(this)">Kataware Doki</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('How_far_Ill_GoMoana')"><skyButton onclick="playSong(this)">How far I'll Go - Moana</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('穿越時空的思念')"><skyButton onclick="playSong(this)">穿越時空的思念 - Inuyasha </skyButton><br></li>
    </ul>
    <ul class="listelement">  
        <h1><c>▶</c> Hard</h1>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('The_Myth_OST')"><skyButton onclick="playSong(this)">The Myth OST</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Music_sheet_8_Extended")'><skyButton onclick="playSong(this)">Music sheet 8 Extended</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Speak_Softly_Love_-_Godfather_Theme")'><skyButton onclick="playSong(this)">Speak Softly Love - Godfather Theme</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick='downloadJSON("Rather_be")'><skyButton onclick="playSong(this)">Rather be</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Chuanyue_shikong_de_sinian')"><skyButton onclick="playSong(this)">Chuanyue shikong de sinian</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Có_Chắc_Yêu_Là_Đây_(Ballad Version)_by_Komo')"><skyButton onclick="playSong(this)">Có Chắc Yêu Là Đây (Ballad Version) by Komo - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Có_Chắc_Yêu_Là_Đây_-_Sơn_Tùng_MTP')"><skyButton onclick="playSong(this)">Có Chắc Yêu Là Đây - Sơn Tùng MTP - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Gravity_Fall_Opening_Theme_Song')"><skyButton onclick="playSong(this)">Gravity Fall Opening Theme Song (Hard) - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Renai_Circulation_-_Kana_Hanazawa_by_Komo_The_Bread')"><skyButton onclick="playSong(this)">Renai Circulation - Kana Hanazawa by Komo The Bread - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Tonari_no_Totoro_-_My_Neighborhood_Is_Totoro_OST')"><skyButton onclick="playSong(this)">Tonari no Totoro - My Neighborhood Is Totoro OST - SCSM</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('He_is_a_pirate')"><skyButton onclick="playSong(this)">He's a pirate</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('He_is_a_pirate(slow)')"><skyButton onclick="playSong(this)">He's a pirate (slow)</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Evangelion_-_A_true_angel_thesis')"><skyButton onclick="playSong(this)">Evangelion - A true angel thesis</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Priscillas_song_-_Skyrim')"><skyButton onclick="playSong(this)">Priscilla's song - Skyrim</skyButton><br></li>
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Alone')"><skyButton onclick="playSong(this)">Alone</skyButton><br></li>    
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Rolling_girl_-_Hatsune_Miku')"><skyButton onclick="playSong(this)">Rolling girl - Hatsune Miku</skyButton><br></li>    
        <li class="content"> <img class="downloadSong" onclick="downloadJSON('Wintergatan_-_Marble_machine')"><skyButton onclick="playSong(this)">Wintergatan - Marble machine</skyButton><br></li>    
    </ul>

        </body>
<script>
        try{
    Sentry.init({ dsn: 'https://b27ef52098ea4301a7faf960dca44f6f@o420766.ingest.sentry.io/5339520' });    
    }catch(e){
        console.log("nope")
    }

    let picker = document.getElementById("selectedSong");
    let lastSongSent = ""

        $('.content').hide();
        $('.listelement').children("h1").on('click', function(){
            if(!($(this.parentElement).children('.content').is(':visible'))){
                $(this.parentElement).children('.content').show();
            } else {
                $('.content').hide();
            }
        });
    function sendSong(btn) {

        var songName = picker.options[picker.selectedIndex].value.trim()
        if (picker.selectedIndex == 0) {
            showMessage("Select a song first!", 0, 1500)
            return
        }
        if (lastSongSent == songName) {
            showMessage("Please don't send the song twice!", 2, 3000)
            return
        }
        if (btn.getAttribute("used") == "true") {
            showMessage("Wait 10 seconds before sending another", 2, 3000)
            return
        }
        let librarySongs = Array.prototype.slice.call(document.getElementsByTagName("skybutton"), 0);
        if (librarySongs.find(e => e.innerHTML == songName)) {
            showMessage("Don't send a song that is already in the library!", 2, 3000)
            return
        }
        btn.setAttribute("used", true)
        lastSongSent = songName
        let storage = JSON.parse(localStorage.getItem("savedSongs"))
        let song = ""
        song = storage.find(s => s.name.trim() === songName)
        let request = new XMLHttpRequest();
        request.open("POST", "/sendSongToDiscord");
        request.setRequestHeader("Content-Type", "application/json; charset=utf-8")
        request.onload = (res) => {
            response = res.target.response;
            showMessage(response, 1, 2500)
            setTimeout(() => {
                btn.setAttribute("used", false)
            }, 10000);
        };
        request.onerror = () => {
            showMessage("Error!", 0, 1500)
            btn.setAttribute("used", false)
        }
        if (song.bpm == undefined) song.bpm = 220
        if (song.pitchLevel == undefined) song.pitchLevel = 0
        if (song.isComposed == undefined) song.isComposed = false
        song.bitsPerPage = 16
        let data = {
            song: convertToNewFormat([song])[0]
        }
        request.send(JSON.stringify(data))
    }
    let localStorageSongs = JSON.parse(localStorage.getItem("savedSongs"))
    if (localStorageSongs != null) {
        for (let i = 0; i < localStorageSongs.length; i++) {
            var option = document.createElement("option")
            option.innerHTML = localStorageSongs[i].name
            picker.appendChild(option)
        }
    }
    var downloadButtons = document.getElementsByClassName("downloadSong")
    for (var i = 0; i < downloadButtons.length; i++) {
        downloadButtons[i].src = "icons/download.png"
    }

    function convertToNewFormat(songs) {
        if (isNaN(songs[0].songNotes[0].key[0])) {
            let convertedSongs = []
            for (let i = 0; i < songs.length; i++) {
                if (songs[i].bpm == undefined) songs[i].bpm = 220
                if (songs[i].pitchLevel == undefined) songs[i].pitchLevel = 0
                if (songs[i].isComposed == undefined) songs[i].isComposed = false
                let newFormat = {
                    name: songs[i].name,
                    bpm: parseInt(songs[i].bpm),
                    bitsPerPage: 16,
                    pitchLevel: parseInt(songs[i].pitchLevel),
                    isComposed: songs[i].isComposed,
                    songNotes: []
                }
                for (let j = 0; j < songs[i].songNotes.length; j++) {
                    let keyObj = {
                        time: songs[i].songNotes[j].time,
                        key: "1" + songs[i].songNotes[j].key
                    }
                    newFormat.songNotes.push(keyObj)
                }
                convertedSongs.push(newFormat)
            }
            return convertedSongs
        } else {
            return songs
        }
    }

    function downloadJSON(song) {
        let request = new XMLHttpRequest();
        request.open('GET', "./librarySongs/" + song + ".txt");
        request.responseType = 'text';
        request.onload = function () {
            var inArray = convertToOldFormat(JSON.parse(request.response))
            var savedSongs = localStorage.getItem("savedSongs")
            if (savedSongs != null) {
                try {
                    savedSongs = JSON.parse(savedSongs)
                } catch(e){
                    savedSongs = []
                }
            } else {
                savedSongs = []
            }
            for (var i = 0; i < inArray.length; i++) {
                var alreadyHasSong = false
                for (var j = 0; j < savedSongs.length; j++) {
                    if (inArray[i].name == savedSongs[j].name) alreadyHasSong = true
                }
                if (inArray.length == 1) {
                    if (!alreadyHasSong) {
                        savedSongs.push((inArray[i]))
                        showMessage('Song "' + inArray[i].name + '" added to your songs!', 1, 2000)
                    } else {
                        showMessage('Song "' + inArray[i].name + '" was already saved!', 0, 2000)
                    }
                } else {
                    if (!alreadyHasSong) {
                        savedSongs.push((inArray[i]))
                    }
                }
            }
            if (inArray.length > 1) showMessage("Added song pack!", 1, 2000)
            localStorage.setItem("savedSongs", JSON.stringify(savedSongs))
            console.log("done")

            return
            //Old thing to download, i keep it in here
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(inArray));
            var dlAnchorElem = document.createElement("a")
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", song + ".txt");
            dlAnchorElem.click();
            dlAnchorElem.remove()
        };
        request.send();
    }

    var notesHandler = document.getElementById("notes")
    var keys = []
    var songsArray = []
    for (var i = 0; i < 15; i++) {
        var audio = document.createElement("audio")
        audio.controls = 'controls';
        audio.src = 'Sounds/Xylophone/' + i + ".mp3";
        audio.type = 'audio/mp3';
        audio.style.display = "none"
        audio.id = "Key" + i
        keys.push(audio)
        notesHandler.appendChild(audio)
    }
    let stopSong = false
    async function playSong(songName) {
        let song = songName.parentElement.children[0].getAttribute('onclick')
        song = song.replace("downloadJSON('", "")
        song = song.replace("')", "")
        song = song.replace('downloadJSON("', "")
        song = song.replace('")', "")
        songName = song
        stopSong = true
        await delay(1500)
        let request = new XMLHttpRequest();
        request.open('GET', "./librarySongs/" + songName + ".txt");
        request.responseType = 'text';
        request.onload = async function () {
            song = convertToOldFormat(JSON.parse(request.response))[0].songNotes
            let delayTime = 0
            let previousTime = 0
            stopSong = false
            for (let i = 0; i < song.length; i++) {
                var keyToPlay = song[i].key
                if (stopSong) break;
                delayTime = song[i].time - previousTime //how much time has to pass from one note to the other
                previousTime = song[i].time
                await delay(delayTime)
                document.getElementById(keyToPlay).currentTime = 0
                document.getElementById(keyToPlay).play()
            }
            stopSong = false
        }
        request.send()
    }

    //-----------------------------------------------------------------------------------//
    function convertToOldFormat(songs) {
        if (!isNaN(songs[0].songNotes[0].key[0])) {
            let convertedSongs = []
            for (let i = 0; i < songs.length; i++) {
                if (songs[i].bpm == undefined) songs[i].bpm = 220
                if (songs[i].pitchLevel == undefined) songs[i].pitchLevel = 0
                if (songs[i].isComposed == undefined) songs[i].isComposed = false
                let oldFormat = {
                    name: songs[i].name,
                    bpm: songs[i].bpm,
                    pitchLevel: songs[i].pitchLevel,
                    bitsPerPage: 16,
                    isComposed: songs[i].isComposed,
                    songNotes: []
                }

                for (let j = 0; j < songs[i].songNotes.length; j++) {
                    let keyObj = {
                        time: songs[i].songNotes[j].time,
                        key: songs[i].songNotes[j].key.substr(1)
                    }
                    oldFormat.songNotes.push(keyObj)
                }
                for (let k = 0; k < oldFormat.songNotes.length; k++) {
                    let max5 = 0
                    for (let x = k + 1; x < oldFormat.songNotes.length && max5 < 5; x++) {
                        if (oldFormat.songNotes[k].time == oldFormat.songNotes[x].time && oldFormat.songNotes[k].key ==
                            oldFormat.songNotes[x].key) {
                            oldFormat.songNotes.splice(k, 1)
                        }
                        max5++
                    }
                }
                convertedSongs.push(oldFormat)
            }
            return convertedSongs
        } else {
            return songs
        }
    }
    const delay = ms => new Promise(res => setTimeout(res, ms))

    function showMessage(msg, msgType, duration) {
        if (duration == undefined) duration = 1500
        floatingMessage = document.getElementById("floatingMessage")
        floatingMessage.innerHTML = msg
        let color
        if (msgType == 0) color = "rgba(235, 0, 27, 0.8)" //ERROR
        if (msgType == 1) color = "lightgreen" //SUCCESS
        if (msgType == 2) color = "#dad8b3" //MESSAGE
       floatingMessage.style.color = color
        $(floatingMessage).fadeIn(200).delay(duration).fadeOut(300)
    }


if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
        .then((reg) => {
          console.log('Service worker registered.', reg);
        });
  });
}
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    let deferredPrompt = e;
    document.getElementById("downloadAPK").style.display = "none"
    let downloadPWABtn = document.getElementById("downloadPWA")
    downloadPWABtn.style.display = 'block'
    downloadPWABtn.addEventListener('click', (e) => {
        downloadPWABtn.style.display = 'none'
        deferredPrompt.prompt()
    })
})
</script>

</html>